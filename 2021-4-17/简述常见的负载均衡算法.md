# 简述常见的负载均衡算法 #

什么是负载均衡？

当一台服务器的性能达到极限时，我们可以使用服务器集群来提高网站的整体性能。那么，在服务器集群中，需要有一台服务器充当调度者的角色，用户的所有请求都会首先由它接收，调度者再根据每台服务器的负载情况将请求分配给某一台后端服务器去处理。那么在这个过程中，调度者如何合理分配任务，保证所有后端服务器都将性能充分发挥，从而保持服务器集群的整体性能最优，这就是负载均衡问题。

第一种：轮询方式

第二种：随机方式

第三种：加权轮询方式

第四种：一致哈希方式

 

轮询方式：

轮询法的优点在于：试图做到请求转移的绝对均衡。

轮询法的缺点在于：为了做到请求转移的绝对均衡，必须付出相当大的代价，因为为了保证pos变量修改的互斥性，需要引入重量级的悲观锁synchronized，这将会导致该段轮询代码的并发吞吐量发生明显的下降。

 

随机方式：通过系统随机函数，根据后端服务器列表的大小值来随机选择其中一台进行访问。由概率统计理论可以得知，随着调用量的增大，其实际效果越来越接近于平均分配流量到每一台后端服务器，也就是轮询的效果。

 

加权轮询：不同的服务器可能机器配置和当前系统的负载并不相同，因此它们的抗压能力也不尽相 同，给配置高、负载低的机器配置更高的权重，让其处理更多的请求，而低配置、高负载的机器，则给其分配较低的权重，降低其系统负载。加权轮询法可以很好地 处理这一问题，并将请求顺序按照权重分配到后端。

 

一致哈希：

步骤：

首先求出memcached服务器（节点）的哈希值，并将其配置到0～232的圆（continuum）上。
然后采用同样的方法求出存储数据的键的哈希值，并映射到相同的圆上。
然后从数据映射到的位置开始顺时针查找，将数据保存到找到的第一个服务器上。如果超过232仍然找不到服务器，就会保存到第一台memcached服务器上。  

![](https://images2015.cnblogs.com/blog/498077/201608/498077-20160822172408386-366341651.png)  

从上图的状态中添加一台memcached服务器。余数分布式算法由于保存键的服务器会发生巨大变化而影响缓存的命中率，但Consistent Hashing中，只有在园（continuum）上增加服务器的地点逆时针方向的第一台服务器上的键会受到影响，如下图所示：

![](https://images2015.cnblogs.com/blog/498077/201608/498077-20160822172431933-546286787.png)  

1、轮询  
将所有请求，依次分发到每台服务器上，适合服务器硬件相同的场景。
优点：服务器请求数目相同；

缺点：服务器压力不一样，不适合服务器配置不同的情况；

2、随机  
请求随机分配到各台服务器上。
优点：使用简单；

缺点：不适合机器配置不同的场景

3、最少链接  
将请求分配到连接数最少的服务器上（目前处理请求最少的服务器）。
优点：根据服务器当前的请求处理情况，动态分配；

缺点：算法实现相对复杂，需要监控服务器请求连接数；

4、Hash（源地址散列）  
根据IP地址进行Hash计算，得到IP地址。
优点：将来自同一IP地址的请求，同一会话期内，转发到相同的服务器；实现会话粘滞。

缺点：目标服务器宕机后，会话会丢失；

5、加权  
在轮询，随机，最少链接，Hash等算法的基础上，通过加权的方式，进行负载服务器分配。

优点：根据权重，调节转发服务器的请求数目；

缺点：使用相对复杂；

参考文档：

1.[https://blog.csdn.net/Z685455/article/details/101583442](https://blog.csdn.net/Z685455/article/details/101583442)  

2.[https://www.cnblogs.com/linjiqin/p/10107398.html](https://www.cnblogs.com/linjiqin/p/10107398.html)